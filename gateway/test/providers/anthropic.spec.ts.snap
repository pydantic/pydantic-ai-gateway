// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`anthropic > should call anthropic via gateway > llm 1`] = `
{
  "content": [
    {
      "text": "The capital of France is Paris.",
      "type": "text",
    },
  ],
  "id": "msg_01Dk1uacDayZhr8zthkRovpM",
  "model": "claude-sonnet-4-20250514",
  "role": "assistant",
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "type": "message",
  "usage": {
    "cache_creation": {
      "ephemeral_1h_input_tokens": 0,
      "ephemeral_5m_input_tokens": 0,
    },
    "cache_creation_input_tokens": 0,
    "cache_read_input_tokens": 0,
    "input_tokens": 20,
    "output_tokens": 10,
    "pydantic_ai_gateway": {
      "cost_estimate": 0.00020999999999999998,
    },
    "service_tier": "standard",
  },
}
`;

exports[`anthropic > should call anthropic via gateway > span 1`] = `
[
  {
    "attributes": {
      "gen_ai.input.messages": [
        {
          "parts": [
            {
              "content": "What is the capital of France?",
              "type": "text",
            },
          ],
          "role": "user",
        },
      ],
      "gen_ai.operation.name": "chat",
      "gen_ai.output.messages": [
        {
          "finish_reason": "end_turn",
          "parts": [
            {
              "content": "The capital of France is Paris.",
              "type": "text",
            },
          ],
          "role": "assistant",
        },
      ],
      "gen_ai.request.max_tokens": 1024,
      "gen_ai.request.model": "claude-sonnet-4-20250514",
      "gen_ai.request.seed": {},
      "gen_ai.request.stop_sequences": [
        "potato",
      ],
      "gen_ai.request.temperature": 0.5,
      "gen_ai.request.top_k": 1,
      "gen_ai.request.top_p": 0.95,
      "gen_ai.response.finish_reasons": [
        "end_turn",
      ],
      "gen_ai.response.id": "msg_01Dk1uacDayZhr8zthkRovpM",
      "gen_ai.response.model": "claude-sonnet-4-20250514",
      "gen_ai.system": "anthropic",
      "gen_ai.system_instructions": [
        {
          "content": "You are a helpful assistant.",
          "type": "text",
        },
      ],
      "gen_ai.usage.cache_audio_read_tokens": {},
      "gen_ai.usage.cache_read_tokens": 0,
      "gen_ai.usage.cache_write_tokens": 0,
      "gen_ai.usage.input_audio_tokens": {},
      "gen_ai.usage.input_tokens": 20,
      "gen_ai.usage.output_audio_tokens": {},
      "gen_ai.usage.output_tokens": 10,
      "http.request.body.text": "{"model":"claude-sonnet-4-20250514","max_tokens":1024,"top_p":0.95,"top_k":1,"temperature":0.5,"stop_sequences":["potato"],"system":"You are a helpful assistant.","messages":[{"role":"user","content":"What is the capital of France?"}]}",
      "http.response.body.text": "{"model":"claude-sonnet-4-20250514","id":"msg_01Dk1uacDayZhr8zthkRovpM","type":"message","role":"assistant","content":[{"type":"text","text":"The capital of France is Paris."}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":20,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":0},"output_tokens":10,"service_tier":"standard","pydantic_ai_gateway":{"cost_estimate":0.00020999999999999998}}}",
      "http.response.status_code": 200,
      "logfire.json_schema": "{"type":"object","properties":{"gen_ai.operation.name":{"type":"string"},"gen_ai.request.model":{"type":"string"},"gen_ai.system":{"type":"string"},"gen_ai.request.max_tokens":{"type":"number"},"gen_ai.request.top_k":{"type":"number"},"gen_ai.request.top_p":{"type":"number"},"gen_ai.request.temperature":{"type":"number"},"gen_ai.request.stop_sequences":{},"gen_ai.request.seed":{},"gen_ai.response.finish_reasons":{},"gen_ai.response.id":{"type":"string"},"gen_ai.input.messages":{},"gen_ai.output.messages":{},"gen_ai.system_instructions":{},"http.response.status_code":{"type":"number"},"http.request.body.text":{"type":"string"},"http.response.body.text":{"type":"string"},"gen_ai.response.model":{"type":"string"},"gen_ai.usage.input_tokens":{"type":"number"},"gen_ai.usage.cache_read_tokens":{"type":"number"},"gen_ai.usage.cache_write_tokens":{"type":"number"},"gen_ai.usage.output_tokens":{"type":"number"},"gen_ai.usage.input_audio_tokens":{},"gen_ai.usage.cache_audio_read_tokens":{},"gen_ai.usage.output_audio_tokens":{}}}",
      "logfire.level_num": 9,
      "logfire.msg": "chat claude-sonnet-4-20250514",
    },
    "events": [],
    "kind": 1,
    "links": [],
    "name": "chat claude-sonnet-4-20250514",
    "parentSpanId": undefined,
    "resource": {
      "service.name": "PAIG",
      "service.version": "test",
    },
    "scope": "pydantic-ai-gateway",
    "status": {
      "code": 1,
    },
  },
]
`;

exports[`anthropic > should call anthropic via gateway with builtin tools > llm 1`] = `
{
  "container": {
    "expires_at": "2025-11-11T12:45:48.055839Z",
    "id": "container_011CV23bhDJwbAJxKGwNRdGZ",
  },
  "content": [
    {
      "text": "I'll calculate the mean and standard deviation of the given dataset [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].",
      "type": "text",
    },
    {
      "id": "srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB",
      "input": {
        "command": "create",
        "file_text": "import math

# Dataset
data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

# Calculate mean
n = len(data)
mean = sum(data) / n

# Calculate standard deviation
# First, calculate variance
squared_differences = [(x - mean) ** 2 for x in data]
variance = sum(squared_differences) / n  # Population standard deviation
std_dev = math.sqrt(variance)

# Also calculate sample standard deviation (dividing by n-1)
sample_variance = sum(squared_differences) / (n - 1)
sample_std_dev = math.sqrt(sample_variance)

print(f"Dataset: {data}")
print(f"Number of values: {n}")
print(f"\\nMean: {mean}")
print(f"\\nPopulation Standard Deviation: {std_dev:.6f}")
print(f"Sample Standard Deviation: {sample_std_dev:.6f}")

# Show the calculation steps
print("\\n--- Calculation Steps ---")
print(f"Sum of all values: {sum(data)}")
print(f"Mean = {sum(data)} / {n} = {mean}")
print(f"\\nSquared differences from mean:")
for i, x in enumerate(data, 1):
    diff = x - mean
    squared_diff = diff ** 2
    print(f"  ({x} - {mean})² = ({diff})² = {squared_diff}")
print(f"\\nSum of squared differences: {sum(squared_differences)}")
print(f"Variance (population) = {sum(squared_differences)} / {n} = {variance}")
print(f"Standard Deviation (population) = √{variance} = {std_dev:.6f}")",
        "path": "/tmp/calculate_stats.py",
      },
      "name": "text_editor_code_execution",
      "type": "server_tool_use",
    },
    {
      "content": {
        "is_file_update": false,
        "type": "text_editor_code_execution_create_result",
      },
      "tool_use_id": "srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB",
      "type": "text_editor_code_execution_tool_result",
    },
    {
      "id": "srvtoolu_01W7BuNqisitDNw8huTmwX7S",
      "input": {
        "command": "cd /tmp && python calculate_stats.py",
      },
      "name": "bash_code_execution",
      "type": "server_tool_use",
    },
    {
      "content": {
        "content": [],
        "return_code": 0,
        "stderr": "",
        "stdout": "Dataset: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
Number of values: 10

Mean: 5.5

Population Standard Deviation: 2.872281
Sample Standard Deviation: 3.027650

--- Calculation Steps ---
Sum of all values: 55
Mean = 55 / 10 = 5.5

Squared differences from mean:
  (1 - 5.5)² = (-4.5)² = 20.25
  (2 - 5.5)² = (-3.5)² = 12.25
  (3 - 5.5)² = (-2.5)² = 6.25
  (4 - 5.5)² = (-1.5)² = 2.25
  (5 - 5.5)² = (-0.5)² = 0.25
  (6 - 5.5)² = (0.5)² = 0.25
  (7 - 5.5)² = (1.5)² = 2.25
  (8 - 5.5)² = (2.5)² = 6.25
  (9 - 5.5)² = (3.5)² = 12.25
  (10 - 5.5)² = (4.5)² = 20.25

Sum of squared differences: 82.5
Variance (population) = 82.5 / 10 = 8.25
Standard Deviation (population) = √8.25 = 2.872281
",
        "type": "bash_code_execution_result",
      },
      "tool_use_id": "srvtoolu_01W7BuNqisitDNw8huTmwX7S",
      "type": "bash_code_execution_tool_result",
    },
    {
      "text": "## Results

For the dataset **[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]**:

- **Mean: 5.5**
- **Standard Deviation (Population): 2.872281**
- **Standard Deviation (Sample): 3.027650**

### Explanation:

1. **Mean**: The average of all values is calculated as the sum (55) divided by the number of values (10), giving us 5.5.

2. **Standard Deviation**: This measures how spread out the numbers are from the mean.
   - **Population standard deviation** (σ) = 2.872281 - used when your data represents the entire population
   - **Sample standard deviation** (s) = 3.027650 - used when your data is a sample from a larger population

The difference between the two is that the sample standard deviation divides by (n-1) instead of n to correct for bias when estimating from a sample.

The calculation shows that the values in this dataset deviate from the mean by approximately 2.87 units on average (using population standard deviation).",
      "type": "text",
    },
  ],
  "id": "msg_01RzdKhnfgoQjW9osANR3pJH",
  "model": "claude-opus-4-1-20250805",
  "role": "assistant",
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "type": "message",
  "usage": {
    "cache_creation": {
      "ephemeral_1h_input_tokens": 0,
      "ephemeral_5m_input_tokens": 0,
    },
    "cache_creation_input_tokens": 0,
    "cache_read_input_tokens": 0,
    "input_tokens": 7934,
    "output_tokens": 899,
    "pydantic_ai_gateway": {
      "cost_estimate": 0.18643500000000002,
    },
    "server_tool_use": {
      "web_search_requests": 0,
    },
    "service_tier": "standard",
  },
}
`;

exports[`anthropic > should call anthropic via gateway with builtin tools > span 1`] = `
[
  {
    "attributes": {
      "gen_ai.input.messages": [
        {
          "parts": [
            {
              "content": "Calculate the mean and standard deviation of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]",
              "type": "text",
            },
          ],
          "role": "user",
        },
      ],
      "gen_ai.operation.name": "chat",
      "gen_ai.output.messages": [
        {
          "finish_reason": "end_turn",
          "parts": [
            {
              "content": "I'll calculate the mean and standard deviation of the given dataset [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].",
              "type": "text",
            },
            {
              "arguments": {
                "command": "create",
                "file_text": "import math

# Dataset
data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

# Calculate mean
n = len(data)
mean = sum(data) / n

# Calculate standard deviation
# First, calculate variance
squared_differences = [(x - mean) ** 2 for x in data]
variance = sum(squared_differences) / n  # Population standard deviation
std_dev = math.sqrt(variance)

# Also calculate sample standard deviation (dividing by n-1)
sample_variance = sum(squared_differences) / (n - 1)
sample_std_dev = math.sqrt(sample_variance)

print(f"Dataset: {data}")
print(f"Number of values: {n}")
print(f"\\nMean: {mean}")
print(f"\\nPopulation Standard Deviation: {std_dev:.6f}")
print(f"Sample Standard Deviation: {sample_std_dev:.6f}")

# Show the calculation steps
print("\\n--- Calculation Steps ---")
print(f"Sum of all values: {sum(data)}")
print(f"Mean = {sum(data)} / {n} = {mean}")
print(f"\\nSquared differences from mean:")
for i, x in enumerate(data, 1):
    diff = x - mean
    squared_diff = diff ** 2
    print(f"  ({x} - {mean})² = ({diff})² = {squared_diff}")
print(f"\\nSum of squared differences: {sum(squared_differences)}")
print(f"Variance (population) = {sum(squared_differences)} / {n} = {variance}")
print(f"Standard Deviation (population) = √{variance} = {std_dev:.6f}")",
                "path": "/tmp/calculate_stats.py",
              },
              "builtin": true,
              "id": "srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB",
              "name": "text_editor_code_execution",
              "type": "tool_call",
            },
            {
              "builtin": true,
              "id": "srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB",
              "name": "text_editor_code_execution",
              "result": {
                "is_file_update": false,
                "type": "text_editor_code_execution_create_result",
              },
              "type": "tool_call_response",
            },
            {
              "arguments": {
                "command": "cd /tmp && python calculate_stats.py",
              },
              "builtin": true,
              "id": "srvtoolu_01W7BuNqisitDNw8huTmwX7S",
              "name": "bash_code_execution",
              "type": "tool_call",
            },
            {
              "builtin": true,
              "id": "srvtoolu_01W7BuNqisitDNw8huTmwX7S",
              "name": "bash_code_execution",
              "result": {
                "content": [],
                "return_code": 0,
                "stderr": "",
                "stdout": "Dataset: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
Number of values: 10

Mean: 5.5

Population Standard Deviation: 2.872281
Sample Standard Deviation: 3.027650

--- Calculation Steps ---
Sum of all values: 55
Mean = 55 / 10 = 5.5

Squared differences from mean:
  (1 - 5.5)² = (-4.5)² = 20.25
  (2 - 5.5)² = (-3.5)² = 12.25
  (3 - 5.5)² = (-2.5)² = 6.25
  (4 - 5.5)² = (-1.5)² = 2.25
  (5 - 5.5)² = (-0.5)² = 0.25
  (6 - 5.5)² = (0.5)² = 0.25
  (7 - 5.5)² = (1.5)² = 2.25
  (8 - 5.5)² = (2.5)² = 6.25
  (9 - 5.5)² = (3.5)² = 12.25
  (10 - 5.5)² = (4.5)² = 20.25

Sum of squared differences: 82.5
Variance (population) = 82.5 / 10 = 8.25
Standard Deviation (population) = √8.25 = 2.872281
",
                "type": "bash_code_execution_result",
              },
              "type": "tool_call_response",
            },
            {
              "content": "## Results

For the dataset **[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]**:

- **Mean: 5.5**
- **Standard Deviation (Population): 2.872281**
- **Standard Deviation (Sample): 3.027650**

### Explanation:

1. **Mean**: The average of all values is calculated as the sum (55) divided by the number of values (10), giving us 5.5.

2. **Standard Deviation**: This measures how spread out the numbers are from the mean.
   - **Population standard deviation** (σ) = 2.872281 - used when your data represents the entire population
   - **Sample standard deviation** (s) = 3.027650 - used when your data is a sample from a larger population

The difference between the two is that the sample standard deviation divides by (n-1) instead of n to correct for bias when estimating from a sample.

The calculation shows that the values in this dataset deviate from the mean by approximately 2.87 units on average (using population standard deviation).",
              "type": "text",
            },
          ],
          "role": "assistant",
        },
      ],
      "gen_ai.request.max_tokens": 4096,
      "gen_ai.request.model": "claude-opus-4-1-20250805",
      "gen_ai.request.seed": {},
      "gen_ai.request.stop_sequences": {},
      "gen_ai.request.temperature": {},
      "gen_ai.request.top_k": {},
      "gen_ai.request.top_p": {},
      "gen_ai.response.finish_reasons": [
        "end_turn",
      ],
      "gen_ai.response.id": "msg_01RzdKhnfgoQjW9osANR3pJH",
      "gen_ai.response.model": "claude-opus-4-1-20250805",
      "gen_ai.system": "anthropic",
      "gen_ai.system_instructions": {},
      "gen_ai.usage.cache_audio_read_tokens": {},
      "gen_ai.usage.cache_read_tokens": 0,
      "gen_ai.usage.cache_write_tokens": 0,
      "gen_ai.usage.input_audio_tokens": {},
      "gen_ai.usage.input_tokens": 7934,
      "gen_ai.usage.output_audio_tokens": {},
      "gen_ai.usage.output_tokens": 899,
      "http.request.body.text": "{"model":"claude-opus-4-1-20250805","max_tokens":4096,"messages":[{"role":"user","content":"Calculate the mean and standard deviation of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"}],"tools":[{"type":"code_execution_20250825","name":"code_execution"}]}",
      "http.response.body.text": "{"model":"claude-opus-4-1-20250805","id":"msg_01RzdKhnfgoQjW9osANR3pJH","type":"message","role":"assistant","content":[{"type":"text","text":"I'll calculate the mean and standard deviation of the given dataset [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]."},{"type":"server_tool_use","id":"srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB","name":"text_editor_code_execution","input":{"command":"create","path":"/tmp/calculate_stats.py","file_text":"import math\\n\\n# Dataset\\ndata = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\\n\\n# Calculate mean\\nn = len(data)\\nmean = sum(data) / n\\n\\n# Calculate standard deviation\\n# First, calculate variance\\nsquared_differences = [(x - mean) ** 2 for x in data]\\nvariance = sum(squared_differences) / n  # Population standard deviation\\nstd_dev = math.sqrt(variance)\\n\\n# Also calculate sample standard deviation (dividing by n-1)\\nsample_variance = sum(squared_differences) / (n - 1)\\nsample_std_dev = math.sqrt(sample_variance)\\n\\nprint(f\\"Dataset: {data}\\")\\nprint(f\\"Number of values: {n}\\")\\nprint(f\\"\\\\nMean: {mean}\\")\\nprint(f\\"\\\\nPopulation Standard Deviation: {std_dev:.6f}\\")\\nprint(f\\"Sample Standard Deviation: {sample_std_dev:.6f}\\")\\n\\n# Show the calculation steps\\nprint(\\"\\\\n--- Calculation Steps ---\\")\\nprint(f\\"Sum of all values: {sum(data)}\\")\\nprint(f\\"Mean = {sum(data)} / {n} = {mean}\\")\\nprint(f\\"\\\\nSquared differences from mean:\\")\\nfor i, x in enumerate(data, 1):\\n    diff = x - mean\\n    squared_diff = diff ** 2\\n    print(f\\"  ({x} - {mean})² = ({diff})² = {squared_diff}\\")\\nprint(f\\"\\\\nSum of squared differences: {sum(squared_differences)}\\")\\nprint(f\\"Variance (population) = {sum(squared_differences)} / {n} = {variance}\\")\\nprint(f\\"Standard Deviation (population) = √{variance} = {std_dev:.6f}\\")"}},{"type":"text_editor_code_execution_tool_result","tool_use_id":"srvtoolu_01SCi7GwiwEDfkyzpSFNAkdB","content":{"type":"text_editor_code_execution_create_result","is_file_update":false}},{"type":"server_tool_use","id":"srvtoolu_01W7BuNqisitDNw8huTmwX7S","name":"bash_code_execution","input":{"command":"cd /tmp && python calculate_stats.py"}},{"type":"bash_code_execution_tool_result","tool_use_id":"srvtoolu_01W7BuNqisitDNw8huTmwX7S","content":{"type":"bash_code_execution_result","stdout":"Dataset: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\\nNumber of values: 10\\n\\nMean: 5.5\\n\\nPopulation Standard Deviation: 2.872281\\nSample Standard Deviation: 3.027650\\n\\n--- Calculation Steps ---\\nSum of all values: 55\\nMean = 55 / 10 = 5.5\\n\\nSquared differences from mean:\\n  (1 - 5.5)² = (-4.5)² = 20.25\\n  (2 - 5.5)² = (-3.5)² = 12.25\\n  (3 - 5.5)² = (-2.5)² = 6.25\\n  (4 - 5.5)² = (-1.5)² = 2.25\\n  (5 - 5.5)² = (-0.5)² = 0.25\\n  (6 - 5.5)² = (0.5)² = 0.25\\n  (7 - 5.5)² = (1.5)² = 2.25\\n  (8 - 5.5)² = (2.5)² = 6.25\\n  (9 - 5.5)² = (3.5)² = 12.25\\n  (10 - 5.5)² = (4.5)² = 20.25\\n\\nSum of squared differences: 82.5\\nVariance (population) = 82.5 / 10 = 8.25\\nStandard Deviation (population) = √8.25 = 2.872281\\n","stderr":"","return_code":0,"content":[]}},{"type":"text","text":"## Results\\n\\nFor the dataset **[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]**:\\n\\n- **Mean: 5.5**\\n- **Standard Deviation (Population): 2.872281**\\n- **Standard Deviation (Sample): 3.027650**\\n\\n### Explanation:\\n\\n1. **Mean**: The average of all values is calculated as the sum (55) divided by the number of values (10), giving us 5.5.\\n\\n2. **Standard Deviation**: This measures how spread out the numbers are from the mean.\\n   - **Population standard deviation** (σ) = 2.872281 - used when your data represents the entire population\\n   - **Sample standard deviation** (s) = 3.027650 - used when your data is a sample from a larger population\\n\\nThe difference between the two is that the sample standard deviation divides by (n-1) instead of n to correct for bias when estimating from a sample.\\n\\nThe calculation shows that the values in this dataset deviate from the mean by approximately 2.87 units on average (using population standard deviation)."}],"container":{"id":"container_011CV23bhDJwbAJxKGwNRdGZ","expires_at":"2025-11-11T12:45:48.055839Z"},"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":7934,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":0},"output_tokens":899,"service_tier":"standard","server_tool_use":{"web_search_requests":0},"pydantic_ai_gateway":{"cost_estimate":0.18643500000000002}}}",
      "http.response.status_code": 200,
      "logfire.json_schema": "{"type":"object","properties":{"gen_ai.operation.name":{"type":"string"},"gen_ai.request.model":{"type":"string"},"gen_ai.system":{"type":"string"},"gen_ai.request.max_tokens":{"type":"number"},"gen_ai.request.top_k":{},"gen_ai.request.top_p":{},"gen_ai.request.temperature":{},"gen_ai.request.stop_sequences":{},"gen_ai.request.seed":{},"gen_ai.response.finish_reasons":{},"gen_ai.response.id":{"type":"string"},"gen_ai.input.messages":{},"gen_ai.output.messages":{},"gen_ai.system_instructions":{},"http.response.status_code":{"type":"number"},"http.request.body.text":{"type":"string"},"http.response.body.text":{"type":"string"},"gen_ai.response.model":{"type":"string"},"gen_ai.usage.input_tokens":{"type":"number"},"gen_ai.usage.cache_read_tokens":{"type":"number"},"gen_ai.usage.cache_write_tokens":{"type":"number"},"gen_ai.usage.output_tokens":{"type":"number"},"gen_ai.usage.input_audio_tokens":{},"gen_ai.usage.cache_audio_read_tokens":{},"gen_ai.usage.output_audio_tokens":{}}}",
      "logfire.level_num": 9,
      "logfire.msg": "chat claude-opus-4-1-20250805",
    },
    "events": [],
    "kind": 1,
    "links": [],
    "name": "chat claude-opus-4-1-20250805",
    "parentSpanId": undefined,
    "resource": {
      "service.name": "PAIG",
      "service.version": "test",
    },
    "scope": "pydantic-ai-gateway",
    "status": {
      "code": 1,
    },
  },
]
`;

exports[`anthropic > should call anthropic via gateway with stream > chunks 1`] = `
[
  {
    "message": {
      "content": [],
      "id": "msg_01FgNH7dqcFgbbZ6o6AV7bpy",
      "model": "claude-opus-4-1-20250805",
      "role": "assistant",
      "stop_reason": null,
      "stop_sequence": null,
      "type": "message",
      "usage": {
        "cache_creation": {
          "ephemeral_1h_input_tokens": 0,
          "ephemeral_5m_input_tokens": 0,
        },
        "cache_creation_input_tokens": 0,
        "cache_read_input_tokens": 0,
        "input_tokens": 14,
        "output_tokens": 7,
        "service_tier": "standard",
      },
    },
    "type": "message_start",
  },
  {
    "content_block": {
      "text": "",
      "type": "text",
    },
    "index": 0,
    "type": "content_block_start",
  },
  {
    "delta": {
      "text": "The capital of France is Paris.",
      "type": "text_delta",
    },
    "index": 0,
    "type": "content_block_delta",
  },
  {
    "index": 0,
    "type": "content_block_stop",
  },
  {
    "delta": {
      "stop_reason": "end_turn",
      "stop_sequence": null,
    },
    "type": "message_delta",
    "usage": {
      "cache_creation_input_tokens": 0,
      "cache_read_input_tokens": 0,
      "input_tokens": 14,
      "output_tokens": 10,
    },
  },
  {
    "type": "message_stop",
  },
]
`;

exports[`anthropic > should call anthropic via gateway with stream > span 1`] = `
[
  {
    "attributes": {
      "gen_ai.operation.name": "chat",
      "gen_ai.request.max_tokens": 1024,
      "gen_ai.request.model": "claude-opus-4-1-20250805",
      "gen_ai.response.id": "msg_01FgNH7dqcFgbbZ6o6AV7bpy",
      "gen_ai.response.model": "claude-opus-4-1-20250805",
      "gen_ai.system": "anthropic",
      "gen_ai.usage.cache_read_tokens": 0,
      "gen_ai.usage.cache_write_tokens": 0,
      "gen_ai.usage.input_tokens": 14,
      "gen_ai.usage.output_tokens": 10,
      "http.request.header.accept": "application/json",
      "http.request.header.anthropic-version": "2023-06-01",
      "http.request.header.authorization": "Bearer healthy",
      "http.request.header.content-type": "application/json",
      "http.request.header.user-agent": "Anthropic/JS 0.62.0",
      "http.request.header.x-stainless-arch": "unknown",
      "http.request.header.x-stainless-lang": "js",
      "http.request.header.x-stainless-os": "Unknown",
      "http.request.header.x-stainless-package-version": "0.62.0",
      "http.request.header.x-stainless-retry-count": "0",
      "http.request.header.x-stainless-runtime": "unknown",
      "http.request.header.x-stainless-runtime-version": "unknown",
      "http.request.header.x-stainless-timeout": "600",
      "http.request.method": "POST",
      "http.response.header.content-type": "text/event-stream; charset=utf-8",
      "http.response.header.server": "uvicorn",
      "http.response.header.transfer-encoding": "chunked",
      "http.response.status_code": 200,
      "logfire.json_schema": "{"type":"object","properties":{"gen_ai.system":{"type":"string"},"gen_ai.operation.name":{"type":"string"},"gen_ai.request.model":{"type":"string"},"gen_ai.request.max_tokens":{"type":"number"},"gen_ai.response.model":{"type":"string"},"gen_ai.response.id":{"type":"string"},"gen_ai.usage.input_tokens":{"type":"number"},"gen_ai.usage.cache_read_tokens":{"type":"number"},"gen_ai.usage.cache_write_tokens":{"type":"number"},"gen_ai.usage.output_tokens":{"type":"number"},"http.request.method":{"type":"string"},"url.full":{"type":"string"},"http.request.header.accept":{"type":"string"},"http.request.header.anthropic-version":{"type":"string"},"http.request.header.authorization":{"type":"string"},"http.request.header.content-type":{"type":"string"},"http.request.header.user-agent":{"type":"string"},"http.request.header.x-stainless-arch":{"type":"string"},"http.request.header.x-stainless-lang":{"type":"string"},"http.request.header.x-stainless-os":{"type":"string"},"http.request.header.x-stainless-package-version":{"type":"string"},"http.request.header.x-stainless-retry-count":{"type":"string"},"http.request.header.x-stainless-runtime":{"type":"string"},"http.request.header.x-stainless-runtime-version":{"type":"string"},"http.request.header.x-stainless-timeout":{"type":"string"},"http.response.status_code":{"type":"number"},"http.response.header.content-type":{"type":"string"},"http.response.header.server":{"type":"string"},"http.response.header.transfer-encoding":{"type":"string"}}}",
      "logfire.level_num": 9,
      "logfire.msg": "chat claude-opus-4-1-20250805",
      "url.full": "https://example.com/anthropic/v1/messages?beta=true",
    },
    "events": [],
    "kind": 1,
    "links": [],
    "name": "chat claude-opus-4-1-20250805",
    "parentSpanId": undefined,
    "resource": {
      "service.name": "PAIG",
      "service.version": "test",
    },
    "scope": "pydantic-ai-gateway",
    "status": {
      "code": 1,
    },
  },
]
`;

exports[`anthropic > should return 404 for unsupported model 1`] = `[Error: 404 PAIG does not support the model \`unsupported-model-xyz\` yet. We're working on it!]`;

exports[`anthropic > should whitelist /v1/messages/count_tokens endpoint > count_tokens 1`] = `
{
  "input_tokens": 14,
}
`;

exports[`anthropic > should whitelist /v1/messages/count_tokens endpoint > span 1`] = `
[
  {
    "attributes": {
      "http.request.body.text": "{"model":"claude-sonnet-4-20250514","messages":[{"role":"user","content":"What is the capital of France?"}]}",
      "http.request.header.accept": "application/json",
      "http.request.header.anthropic-beta": "token-counting-2024-11-01",
      "http.request.header.anthropic-version": "2023-06-01",
      "http.request.header.authorization": "Bearer healthy",
      "http.request.header.content-type": "application/json",
      "http.request.header.user-agent": "Anthropic/JS 0.62.0",
      "http.request.header.x-stainless-arch": "unknown",
      "http.request.header.x-stainless-lang": "js",
      "http.request.header.x-stainless-os": "Unknown",
      "http.request.header.x-stainless-package-version": "0.62.0",
      "http.request.header.x-stainless-retry-count": "0",
      "http.request.header.x-stainless-runtime": "unknown",
      "http.request.header.x-stainless-runtime-version": "unknown",
      "http.request.method": "POST",
      "http.response.header.content-length": "19",
      "http.response.header.content-type": "application/json",
      "http.response.header.server": "uvicorn",
      "http.response.status_code": 200,
      "logfire.json_schema": "{"type":"object","properties":{"http.request.method":{"type":"string"},"url.full":{"type":"string"},"http.request.header.accept":{"type":"string"},"http.request.header.anthropic-beta":{"type":"string"},"http.request.header.anthropic-version":{"type":"string"},"http.request.header.authorization":{"type":"string"},"http.request.header.content-type":{"type":"string"},"http.request.header.user-agent":{"type":"string"},"http.request.header.x-stainless-arch":{"type":"string"},"http.request.header.x-stainless-lang":{"type":"string"},"http.request.header.x-stainless-os":{"type":"string"},"http.request.header.x-stainless-package-version":{"type":"string"},"http.request.header.x-stainless-retry-count":{"type":"string"},"http.request.header.x-stainless-runtime":{"type":"string"},"http.request.header.x-stainless-runtime-version":{"type":"string"},"http.response.status_code":{"type":"number"},"http.response.header.content-length":{"type":"string"},"http.response.header.content-type":{"type":"string"},"http.response.header.server":{"type":"string"},"http.request.body.text":{"type":"string"}}}",
      "logfire.level_num": 9,
      "logfire.msg": "POST v1/messages/count_tokens?beta=true",
      "url.full": "https://example.com/anthropic/v1/messages/count_tokens?beta=true",
    },
    "events": [],
    "kind": 1,
    "links": [],
    "name": "POST v1/messages/count_tokens?beta=true",
    "parentSpanId": undefined,
    "resource": {
      "service.name": "PAIG",
      "service.version": "test",
    },
    "scope": "pydantic-ai-gateway",
    "status": {
      "code": 1,
    },
  },
]
`;
